version: 2

models:
  - name: mart_nba_team_trends
    description: NBA team performance trends analysis
    tests:
      - unique:
          column_name: "team_name || '-' || game_id"
      - not_null:
          column_name: team_name
    columns:
      - name: game_id
        tests:
          - not_null
          - relationships:
              to: ref('fct_games')
              field: game_id

      - name: team_type
        tests:
          - not_null
          - accepted_values:
              values: ['HOME', 'AWAY']

      - name: avg_points_per_game
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 70
              max_value: 150

      - name: avg_fg_pct
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0.3
              max_value: 0.7

      - name: avg_3p_pct
        tests:
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0.2
              max_value: 0.5

      - name: avg_ft_pct
        tests:
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0.6
              max_value: 1.0

      - name: win_percentage
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0
              max_value: 100

      # Custom tests for data validation
      - name: performance_metrics
        tests:
          - dbt_utils.expression_is_true:
              expression: "avg_assists >= 15 and avg_rebounds >= 30"
          - dbt_utils.expression_is_true:
              expression: "total_wins <= total_games"
